本稿は[自作エディタをつくる Advent Calendar 2016](http://qiita.com/advent-calendar/2016/make_editor)の21日目です、レポジトリは[こちら](https://github.com/tinyco/tiny_code_editor)

# プルリクエストをもらう

equal-l2氏から2件プルリクエストをもらいました٩(๑❛ᴗ❛๑)۶
自分がこまめにpushしていなかったせいでconflictしてもらって申し訳ない(しかも直してもらった。。。)

1件目はmakefileに関するもので、暗黙変数を使うようにするものです。

16日目にmakefileを書き間違えてgcc(指定したつもりが、設定ミス)ではなくcc(デフォルト)でコンパイルされていました。
そういうデフォルトルールがいくつかあるらしく[参考](http://www.ecoop.net/coop/translated/GNUMake3.77/make_10.jp.html)、
デフォルト設定を使えばmakeする人の環境に合わせてビルドできる確率があがりそうなので、できるだけ使った方が良い気がしますね。

あわせて、makefileを少しリファクタリングしました。

2件目はスペルミスの修正です。

単純にスペルが間違ってるもののほかに、
`lines_calculatotion_width` → `lines_calculate_width`のように動詞と名詞が違うものと、
`ARROW`(矢印キー)はutf8として正しくないが`ALLOW`しているネーミングセンスのわかりにくい旨の修正がありました。
自分でもわかりにくいと思って`ARROW_KEY`にリネームしていたのでconflictしてしまいました。

# テストを充実させる

自分の中ではMVCでいうとMのコードにテストを増やしていきました。

備考：自分の中の基準

- M -> typeフォルダ
- V -> renderフォルダ
- C -> commandフォルダ

なので、typeフォルダのコードにテストをつけました。
条件分岐を網羅してないですが、該当フォルダには全メソッドテストがつきました。
基本的にテストしたい関数を呼んでprintfするだけなので、お手軽なのが良いですね。
Cは自分の中で根本的に変えたいところが多いので、とりあえず放置です。
VはAutotest.mkに似た方式(21日目)を使っているので比較的簡単にテストできますが(エディタと相性が良い)、
そもそも今の動作は正解なんだろうか？というのもあり、軽く差分がわかるぐらいにしておきました。

テストを増やしたので、バグを2つみつけました。
1つめは、asciiコードだと上手くいっていたがutf8だと上手くいかないところで、
2つめは、free先がファイル先端・末尾を超えている時にセグフォでした。
テストがあったらあったで色々わかっていいですね。
せっかくなので、変数名のリネームもしまくります。

あと、モンキーテストで見つけたバグもいくつか直しました。

# include を整理する

いままで適当にincludeしていたheaderを整理しました
あわせて、clang-formatのSortIncludesをtrueにしました

# 今日のまとめ

- テストが充実しました
- bugをいくつか修正しました
- includeを整理しました

知人のrubyエンジニアにiOSアプリの作り方を休みに教えていた、っていう更新が遅れた言い訳でした。

19日目のコメントの静的解析ツールが気になります、valgrindも動かしたいけど。
残り日数も少ないですが、目標としては25日目のブログまでに検索とコピーペーストをつけたい！